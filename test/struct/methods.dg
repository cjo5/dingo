include "../common.dg"

struct Foo {
    var count: I32

    fun bar(f: &Foo, a: I32) {
        io::printiln(f.get())
        io::printiln(a)
    }

    fun inc(&var Self) {
        self.count++
    }

    fun inc_twice(f: &var Self) {
        f.inc()
        f.inc()
    }

    fun inc_thrice(&var Foo) {
        self.inc()
        self.inc()
        self.inc()
    }

    fun get(&Self) I32 {
        return self.count
    }
}

extern fun main() C_int {
    val f = Foo(1)
    f.bar(2)
    // expect: 1
    // expect: 2

    var f2 = Foo(3)
    val bar = f.bar
    bar(f2, 4)
    // expect: 3
    // expect: 4

    f2.inc()
    f2.inc()
    io::printiln(f2.count)
    // expect: 5

    f2.inc_twice()
    f2.inc_thrice()
    io::printiln(f2.count)
    // expect: 10

    io::printiln(f2.get())
    // expect: 10

    return 0
}